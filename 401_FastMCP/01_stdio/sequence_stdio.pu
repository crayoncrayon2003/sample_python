@startuml sequence_stdio.pu
skinparam backgroundColor #FFFFFF
skinparam sequenceMessageAlign center

box "MCPクライアント" #F0F8FF
    participant "C1\n(送受信用: stdio)" as C1
    participant "C2\n(SSE版と比較のため記載)" as C2
end box

box "MCPサーバ" #F8F0FF
    participant "S1\n(stdIO処理担当)" as S1
end box

box "外部システム" #FFF5EE
    participant "REST APIサーバ\n" as API
end box

' --- Step 1 ---
== Step 1: 接続確立 ==
C1 -> S1 : stdio接続開始
activate C1
activate S1
S1 -->> C1 : 初期化応答 (session_id=XXXX)
note right of C1 : C1 がstdin/stdoutで\nレスポンス受信

' --- Step 2 ---
== Step 2: 初期化 (Initialize) ==
C2 -> S1 : [SSE版比較用コメント] Initialize指示
activate C2
S1 -->> C1 : initialize結果
deactivate C2

' --- Step 3 ---
== Step 3: ツールリスト要求 (listTools) ==
C2 -> S1 : [SSE版比較用コメント] listTools指示
activate C2
S1 -->> C1 : ツールリスト返却
deactivate C2

' --- Step 4 ---
== Step 4: ツール実行 (callTool) ==
C2 -> S1 : [SSE版比較用コメント] callTool指示
activate C2

group タスク処理 (外部連携)
    S1 -> API : APIリクエスト
    activate API
    API -->> S1 : 実行結果
    deactivate API
end

S1 -->> C1 : callTool結果返却
deactivate C2

' --- Step 5 ---
== Step 5: 接続終了 ==
C2 -> S1 : [SSE版比較用コメント] exit指示
activate C2
S1 -->> C1 : 終了通知
deactivate C2

deactivate S1
deactivate C1
note over C1, S1 : stdioコネクション切断
@enduml
